{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "hubName",
        "type": "Microsoft.Common.TextBox",
        "label": "FinOps Hub Name",
        "defaultValue": "finops-hub",
        "toolTip": "Unique name for your FinOps Hub. This will be used as a prefix for all resources.",
        "placeholder": "my-company-finops-hub",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9-]{3,24}$",
          "validationMessage": "Hub name must be 3-24 characters long and can only contain lowercase letters, numbers, and hyphens."
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "configuration",
        "label": "Configuration",
        "elements": [
          {
            "name": "deploymentInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Info",
              "text": "This deployment will create:\n‚Ä¢ Storage Account (Data Lake Gen2)\n‚Ä¢ Azure Data Factory with pipelines\n‚Ä¢ Key Vault\n‚Ä¢ 3 Managed Identities\n‚Ä¢ Event Grid System Topic\n\nEstimated cost: $5-20/month | Deployment time: 15-20 min"
            }
          },
          {
            "name": "storageSku",
            "type": "Microsoft.Common.DropDown",
            "label": "Storage SKU",
            "defaultValue": "Premium_LRS (Locally Redundant)",
            "toolTip": "Select storage redundancy. LRS is lowest cost, ZRS provides high availability across availability zones.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Premium_LRS (Locally Redundant)",
                  "value": "Premium_LRS"
                },
                {
                  "label": "Premium_ZRS (Zone Redundant)",
                  "value": "Premium_ZRS"
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "exportConfigInfo",
            "type": "Microsoft.Common.InfoBox",
            "visible": true,
            "options": {
              "icon": "Warning",
              "text": "‚ö†Ô∏è Export Configuration Required\n\nFor CSP subscriptions, Cost Management exports must be configured manually through the Azure Portal after deployment.\n\nüìò Complete setup instructions: https://EuphoriaLux.github.io/finops-hub-deployment/\n\nEstimated time: 5-10 minutes per subscription"
            }
          }
        ]
      },
      {
        "name": "advanced",
        "label": "Advanced Settings",
        "elements": [
          {
            "name": "enablePublicAccess",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Enable Public Access",
            "defaultValue": "Yes",
            "toolTip": "Allow public network access to resources. Select 'No' for private network deployment.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": true
                },
                {
                  "label": "No",
                  "value": false
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "enableInfrastructureEncryption",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Enable Infrastructure Encryption",
            "defaultValue": "No",
            "toolTip": "Enable double encryption on storage account for enhanced security (additional cost).",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": true
                },
                {
                  "label": "No",
                  "value": false
                }
              ],
              "required": true
            },
            "visible": true
          },
          {
            "name": "ingestionRetentionInMonths",
            "type": "Microsoft.Common.Slider",
            "min": 1,
            "max": 36,
            "label": "Data Retention (Months)",
            "subLabel": "months",
            "defaultValue": 13,
            "toolTip": "Number of months to retain processed cost data in the ingestion container.",
            "constraints": {
              "required": false
            },
            "visible": true
          },
          {
            "name": "tags",
            "type": "Microsoft.Common.TagsByResource",
            "resources": [
              "Microsoft.Storage/storageAccounts",
              "Microsoft.DataFactory/factories",
              "Microsoft.KeyVault/vaults"
            ],
            "toolTip": "Add tags to your resources for organization and cost tracking."
          }
        ]
      }
    ],
    "outputs": {
      "location": "[location()]",
      "hubName": "[basics('hubName')]",
      "storageSku": "[steps('configuration').storageSku]",
      "enableInfrastructureEncryption": "[steps('advanced').enableInfrastructureEncryption]",
      "enableManagedExports": false,
      "dataExplorerName": "",
      "dataExplorerSku": "Dev(No SLA)_Standard_D11_v2",
      "dataExplorerCapacity": 1,
      "fabricQueryUri": "",
      "fabricCapacityUnits": 2,
      "tags": "[steps('advanced').tags]",
      "tagsByResource": {},
      "scopesToMonitor": [],
      "exportRetentionInDays": 0,
      "ingestionRetentionInMonths": "[steps('advanced').ingestionRetentionInMonths]",
      "dataExplorerRawRetentionInDays": 0,
      "dataExplorerFinalRetentionInMonths": 13,
      "enablePublicAccess": "[steps('advanced').enablePublicAccess]",
      "virtualNetworkAddressPrefix": "10.20.30.0/26",
      "remoteHubStorageUri": "",
      "remoteHubStorageKey": ""
    }
  }
}
