<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinOps Hub - Deployment Guide</title>

    <!-- External CSS for Interactive Features -->
    <link rel="stylesheet" href="css/interactive.css">

    <!-- Prism.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

    <style>
        :root {
            --primary-color: #0078d4;
            --secondary-color: #50e6ff;
            --success-color: #10893e;
            --warning-color: #faa21b;
            --danger-color: #e81123;
            --dark-bg: #1e1e1e;
            --card-bg: #ffffff;
            --text-primary: #323130;
            --text-secondary: #605e5c;
            --border-color: #edebe9;
            --code-bg: #f3f2f1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #005a9e 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        nav {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav ul li {
            margin: 0;
        }

        nav ul li a {
            display: block;
            padding: 1rem 1.5rem;
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        nav ul li a:hover {
            background: var(--code-bg);
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }

        main {
            padding: 3rem 0;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--secondary-color);
        }

        h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem 0;
        }

        h4 {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 6px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e6f4ff;
            border-left-color: var(--primary-color);
            color: #004085;
        }

        .alert-success {
            background: #d4edda;
            border-left-color: var(--success-color);
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-left-color: var(--warning-color);
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-left-color: var(--danger-color);
            color: #721c24;
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        pre {
            background: var(--dark-bg);
            color: #d4d4d4;
            padding: 1.5rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
            border-left: 4px solid var(--primary-color);
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .steps {
            counter-reset: step-counter;
            list-style: none;
        }

        .steps li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 3rem;
            margin-bottom: 1.5rem;
        }

        .steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--primary-color);
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .btn {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #005a9e;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,120,212,0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #0c6b2f;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
            border-radius: 6px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: var(--code-bg);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .feature-box {
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border-top: 4px solid var(--primary-color);
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .feature-box h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        footer {
            background: var(--dark-bg);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        footer a {
            color: var(--secondary-color);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .toc {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 6px;
            margin: 2rem 0;
        }

        .toc ul {
            list-style: none;
            padding-left: 1rem;
        }

        .toc ul li {
            margin: 0.5rem 0;
        }

        .toc a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        /* User Path Selection Styles */
        .user-path-selector .feature-box {
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .user-path-selector .feature-box:hover {
            border-color: var(--primary-color);
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0,120,212,0.3);
        }

        .user-path-selector .feature-box ul {
            list-style: none;
            padding: 0;
        }

        .user-path-selector .feature-box ul li {
            padding: 0.5rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        .user-path-selector .feature-box ul li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            nav ul {
                flex-direction: column;
            }

            nav ul li a {
                border-bottom: 1px solid var(--border-color);
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 0 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>FinOps Hub Deployment Guide</h1>
            <p>Complete guide for deploying and configuring FinOps Hub with FOCUS exports</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#" onclick="showUserPath('selection'); return false;">üè† Start</a></li>
            <li><a href="#overview">Overview</a></li>
            <li><a href="#architecture">Architecture</a></li>
            <li><a href="#config-builder">Configuration</a></li>
            <li><a href="#deployment-lambda">Deploy (Portal)</a></li>
            <li><a href="#deployment-developer">Deploy (Script)</a></li>
            <li><a href="#export-wizard">Export Wizard</a></li>
            <li><a href="#csp">CSP Info</a></li>
            <li><a href="#troubleshooting">Troubleshooting</a></li>
        </ul>
    </nav>

    <main class="container">
        <!-- User Path Selection Section -->
        <section id="user-path-selection" class="card user-path-selector" style="text-align: center; padding: 3rem 2rem;">
            <h2>Choose Your Deployment Path</h2>
            <p style="font-size: 1.2rem; margin-bottom: 2rem;">Select the path that best describes your technical background</p>

            <div class="grid" style="gap: 3rem; max-width: 900px; margin: 0 auto;">
                <div class="feature-box" style="cursor: pointer; padding: 2rem;" onclick="showUserPath('lambda')">
                    <div class="icon" style="font-size: 4rem;">üë§</div>
                    <h3 style="color: var(--primary-color); font-size: 1.8rem;">Business User</h3>
                    <p style="font-size: 1.1rem; margin: 1rem 0;">I prefer using the Azure Portal</p>
                    <ul style="text-align: left; margin: 1rem 0;">
                        <li>Point-and-click deployment</li>
                        <li>Visual step-by-step guide</li>
                        <li>No coding or scripting required</li>
                        <li>Portal-based configuration</li>
                    </ul>
                    <button class="btn btn-primary btn-lg" style="margin-top: 1rem;">I'm a Business User</button>
                </div>
                <div class="feature-box" style="cursor: pointer; padding: 2rem;" onclick="showUserPath('developer')">
                    <div class="icon" style="font-size: 4rem;">üë®‚Äçüíª</div>
                    <h3 style="color: var(--primary-color); font-size: 1.8rem;">Developer/IT Pro</h3>
                    <p style="font-size: 1.1rem; margin: 1rem 0;">I'm comfortable with PowerShell/CLI</p>
                    <ul style="text-align: left; margin: 1rem 0;">
                        <li>PowerShell & Azure CLI scripts</li>
                        <li>Automated deployment</li>
                        <li>Infrastructure as Code</li>
                        <li>Scripted configuration</li>
                    </ul>
                    <button class="btn btn-primary btn-lg" style="margin-top: 1rem;">I'm a Developer</button>
                </div>
            </div>

            <div class="alert alert-info" style="margin-top: 2rem; text-align: left;">
                <strong>Not sure which path to choose?</strong><br>
                If you're comfortable using PowerShell or Azure CLI, choose the Developer path for faster automation. Otherwise, the Business User path provides a more guided, visual experience through the Azure Portal.
            </div>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="card" style="display: none;">
            <div style="text-align: right; margin-bottom: 1rem;">
                <button onclick="showUserPath('selection')" class="btn btn-primary" style="font-size: 0.9rem;">‚Üê Change Deployment Path</button>
            </div>

            <h2>Overview</h2>
            <p>Welcome to the FinOps Hub deployment guide. This comprehensive documentation will help you deploy and configure Microsoft's FinOps Hub solution with FOCUS 1.0 cost exports.</p>

            <div class="grid">
                <div class="feature-box">
                    <div class="icon">üöÄ</div>
                    <h3>One-Click Deployment</h3>
                    <p>Deploy the complete FinOps Hub infrastructure with a single ARM template</p>
                </div>
                <div class="feature-box">
                    <div class="icon">üìä</div>
                    <h3>FOCUS 1.0 Exports</h3>
                    <p>Industry-standard cost data format with Parquet compression</p>
                </div>
                <div class="feature-box">
                    <div class="icon">üí∞</div>
                    <h3>Cost Optimization</h3>
                    <p>Comprehensive cost visibility across all Azure subscriptions</p>
                </div>
            </div>

            <div class="alert alert-info">
                <strong>What is FinOps Hub?</strong><br>
                FinOps Hub is Microsoft's open-source framework for cost management and optimization in Azure. It provides automated data collection, processing, and visualization of cost data across your entire Azure estate.
            </div>

            <h3>What You'll Deploy</h3>
            <ul>
                <li>Storage Account for cost export data</li>
                <li>Data Factory for automated data processing</li>
                <li>Power BI reports for cost visualization</li>
                <li>Automated FOCUS 1.0 cost exports (manual configuration required)</li>
            </ul>

            <h3>Prerequisites</h3>
            <div class="alert alert-danger">
                <strong>‚ö†Ô∏è CRITICAL:</strong> You MUST register the <code>Microsoft.EventGrid</code> resource provider <strong>BEFORE</strong> deployment. If not registered, the Event Grid System Topic won't be created and automatic processing will NOT work.
            </div>
            <ul>
                <li>Azure subscription with Owner or Contributor role</li>
                <li><strong>Microsoft.EventGrid resource provider registered (REQUIRED BEFORE DEPLOYMENT)</strong></li>
                <li>Microsoft.Storage resource provider registered</li>
                <li>Cost Management Contributor role (for manual export creation via Portal)</li>
            </ul>

            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è CSP-Optimized Template:</strong> This template is designed for CSP and standard Azure subscriptions. <code>Microsoft.CostManagementExports</code> provider is <strong>NOT required</strong> - Cost Management exports must be created manually via Azure Portal (automated export creation is disabled via <code>enableManagedExports: false</code>).
            </div>

            <h4>Register Event Grid Provider</h4>
            <pre><code class="language-powershell"># Register Event Grid provider
az provider register --namespace Microsoft.EventGrid

# Verify registration (wait until status is "Registered")
az provider show --namespace Microsoft.EventGrid --query "registrationState" --output tsv</code></pre>
            <p><strong>‚è±Ô∏è Registration takes 1-2 minutes</strong> - wait for "Registered" status before deploying.</p>

            <div class="alert alert-info">
                <strong>üìã Post-Deployment:</strong> After deployment completes, follow the <a href="../POST-DEPLOYMENT-CHECKLIST.md" target="_blank">Post-Deployment Checklist</a> to verify all components are configured correctly.
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="architecture" class="card interactive-section">
            <h2>üèóÔ∏è Architecture Diagram</h2>
            <p>Explore the interactive architecture diagram to understand how FinOps Hub components work together to collect, process, and visualize your Azure cost data.</p>

            <div class="architecture-container">
                <div class="architecture-controls">
                    <div>
                        <button id="playAnimation" class="btn btn-primary">‚ñ∂ Play Data Flow</button>
                    </div>
                    <div class="architecture-toggle">
                        <input type="checkbox" id="toggleDataExplorer">
                        <label for="toggleDataExplorer">Show Azure Data Explorer (Optional)</label>
                    </div>
                    <div id="flowDescription" class="flow-description" style="display: none;"></div>
                </div>

                <!-- Architecture Grid Layout -->
                <div class="architecture-grid">
                    <!-- Row 1: Cost Management -->
                    <div class="arch-component" data-component="costManagement" style="grid-column: 1; grid-row: 1;">
                        <div class="arch-icon">üí∞</div>
                        <div class="arch-name">Cost Management</div>
                        <div class="arch-cost">Free</div>
                    </div>

                    <!-- Row 2: Storage and Event Grid -->
                    <div class="arch-component" data-component="storage" style="grid-column: 2; grid-row: 2;">
                        <div class="arch-icon">üíæ</div>
                        <div class="arch-name">Storage Account</div>
                        <div class="arch-cost">$5-10/mo</div>
                    </div>

                    <div class="arch-component" data-component="eventGrid" style="grid-column: 3; grid-row: 2;">
                        <div class="arch-icon">‚ö°</div>
                        <div class="arch-name">Event Grid</div>
                        <div class="arch-cost">$0.50/mo</div>
                    </div>

                    <!-- Row 3: Data Factory and Security -->
                    <div class="arch-component" data-component="dataFactory" style="grid-column: 2; grid-row: 3;">
                        <div class="arch-icon">üè≠</div>
                        <div class="arch-name">Data Factory</div>
                        <div class="arch-cost">$2-5/mo</div>
                    </div>

                    <div class="arch-component" data-component="keyVault" style="grid-column: 3; grid-row: 3;">
                        <div class="arch-icon">üîê</div>
                        <div class="arch-name">Key Vault</div>
                        <div class="arch-cost">$0.50/mo</div>
                    </div>

                    <div class="arch-component" data-component="managedIdentity" style="grid-column: 4; grid-row: 3;">
                        <div class="arch-icon">üîë</div>
                        <div class="arch-name">Managed Identities</div>
                        <div class="arch-cost">Free</div>
                    </div>

                    <!-- Row 4: Optional Data Explorer and Power BI -->
                    <div class="arch-component optional-adx" data-component="dataExplorer" style="grid-column: 2; grid-row: 4; display: none;">
                        <div class="arch-icon">üìä</div>
                        <div class="arch-name">Data Explorer</div>
                        <div class="arch-cost">$150+/mo</div>
                    </div>

                    <div class="arch-component" data-component="powerBI" style="grid-column: 4; grid-row: 4;">
                        <div class="arch-icon">üìà</div>
                        <div class="arch-name">Power BI</div>
                        <div class="arch-cost">Separate License</div>
                    </div>
                </div>

                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>üí° Interactive Features:</strong>
                    <ul>
                        <li>Click any component to see detailed information</li>
                        <li>Toggle Data Explorer to see optional deployment</li>
                        <li>Play animation to visualize data flow</li>
                        <li>Estimated total cost: <strong id="architectureCost">$8-20/month</strong></li>
                    </ul>
                </div>
            </div>

            <!-- Component Detail Panel (slides in from right) -->
            <div id="componentDetailPanel" class="component-detail-panel">
                <button id="closeDetailPanel" class="close-btn" aria-label="Close">√ó</button>
                <div id="componentDetailContent"></div>
            </div>
        </section>

        <!-- Configuration Builder Section -->
        <section id="config-builder" class="card interactive-section">
            <h2>‚öôÔ∏è Deployment Configuration Builder</h2>
            <p>Use this interactive tool to plan your FinOps Hub deployment parameters, estimate costs in real-time, and get a deployment link with your configuration as a reference. Your settings are saved locally for easy reference when deploying.</p>

            <div class="config-builder-form">
                <!-- Hub Name -->
                <div class="form-group full-width">
                    <label for="configHubName">Hub Name *</label>
                    <input type="text" id="configHubName" placeholder="e.g., contoso-finops" maxlength="24">
                    <span class="help-text">3-24 characters, lowercase letters and numbers only</span>
                </div>

                <!-- Region -->
                <div class="form-group">
                    <label for="configRegion">Azure Region *</label>
                    <select id="configRegion"></select>
                    <span class="help-text">Choose a region close to your primary location</span>
                </div>

                <!-- Subscription Count -->
                <div class="form-group">
                    <label for="configSubscriptionCount">Number of Subscriptions</label>
                    <input type="number" id="configSubscriptionCount" value="1" min="1" max="1000">
                    <span class="help-text">For cost estimation purposes</span>
                </div>

                <!-- Storage SKU -->
                <div class="form-group full-width">
                    <label>Storage SKU *</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="skuLRS" name="configStorageSku" value="Premium_LRS" checked>
                            <div class="radio-option-label">
                                <label for="skuLRS"><strong>Premium LRS</strong> - Locally Redundant Storage</label>
                                <div class="radio-option-description">Lower cost, single datacenter redundancy (Recommended for dev/test)</div>
                            </div>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="skuZRS" name="configStorageSku" value="Premium_ZRS">
                            <div class="radio-option-label">
                                <label for="skuZRS"><strong>Premium ZRS</strong> - Zone Redundant Storage</label>
                                <div class="radio-option-description">Higher availability, zone-redundant (Recommended for production)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Retention Policies -->
                <div class="form-group">
                    <label for="configExportRetention">Raw Export Retention (days)</label>
                    <input type="number" id="configExportRetention" value="0" min="0" max="365">
                    <span class="help-text">0 = Delete after processing (recommended)</span>
                </div>

                <div class="form-group">
                    <label for="configIngestionRetention">Processed Data Retention (months)</label>
                    <input type="number" id="configIngestionRetention" value="13" min="1" max="36">
                    <span class="help-text">Recommended: 13 months for year-over-year comparison</span>
                </div>

                <!-- Advanced Options (Collapsible) -->
                <div class="form-group full-width">
                    <div id="toggleAdvanced" class="toggle-section">‚ñ∂ Show Advanced Options</div>
                    <div id="advancedOptions" style="display: none;">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="configEnablePublicAccess" checked>
                                Enable Public Network Access
                            </label>
                            <span class="help-text">Disable for private endpoint only access</span>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="configEnableInfraEncryption">
                                Enable Infrastructure Encryption
                            </label>
                            <span class="help-text">Double encryption for compliance requirements</span>
                        </div>

                        <div class="form-group">
                            <label for="configDataExplorerName">Data Explorer Cluster Name (Optional)</label>
                            <input type="text" id="configDataExplorerName" placeholder="Leave empty to skip">
                            <span class="help-text">Only needed for large datasets (>$2M monthly spend)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cost Estimate -->
            <div class="cost-estimate-card">
                <h3>üíµ Estimated Monthly Cost</h3>
                <div class="cost-total" id="estimatedCost">$8.00</div>
                <div class="cost-breakdown" id="costBreakdown"></div>
            </div>

            <!-- ROI Estimate -->
            <div id="roiEstimate"></div>

            <!-- Recommendations -->
            <div id="configRecommendations" style="display: none;"></div>

            <!-- Resource Names Preview -->
            <div id="resourceNamePreview"></div>

            <!-- Generate Button -->
            <div style="text-align: center; margin: 2rem 0;">
                <button id="generateDeployBtn" class="btn btn-primary btn-lg">Generate Deployment Link</button>
            </div>

            <!-- Deployment Summary (hidden until generated) -->
            <div id="deploymentSummary" style="display: none;"></div>
        </section>

        <!-- Business User Deployment Section -->
        <section id="deployment-lambda" class="card user-path-content lambda-content" style="display: none;">
            <div style="text-align: right; margin-bottom: 1rem;">
                <button type="button" onclick="showUserPath('selection')" class="btn btn-primary" style="font-size: 0.9rem;">‚Üê Change Deployment Path</button>
            </div>

            <h2>üìñ Business User Deployment Guide</h2>
            <p class="alert alert-info">This guide will walk you through deploying FinOps Hub using the Azure Portal - no scripting or coding required!</p>

            <h3>üìã Prerequisites Checklist</h3>
            <div class="alert alert-warning">
                <strong>Before you begin, ensure you have:</strong>
                <ul>
                    <li>‚úÖ Access to Azure Portal (<a href="https://portal.azure.com" target="_blank" rel="noopener noreferrer">portal.azure.com</a>)</li>
                    <li>‚úÖ Contributor role on your Azure subscription</li>
                    <li>‚úÖ 20-30 minutes of time</li>
                </ul>
            </div>

            <h3>Step 1: Register Event Grid Provider (CRITICAL)</h3>
            <div class="alert alert-danger">
                <strong>‚ö†Ô∏è IMPORTANT:</strong> You must complete this step BEFORE deploying, or automatic processing won't work!
            </div>

            <ol class="steps">
                <li>
                    <strong>Open Azure Portal</strong>
                    <p>Go to <a href="https://portal.azure.com" target="_blank" rel="noopener noreferrer">https://portal.azure.com</a> and sign in</p>
                </li>
                <li>
                    <strong>Navigate to Subscriptions</strong>
                    <p>In the search bar at the top, type "Subscriptions" and click on it</p>
                </li>
                <li>
                    <strong>Select Your Subscription</strong>
                    <p>Click on the subscription where you want to deploy FinOps Hub</p>
                </li>
                <li>
                    <strong>Open Resource Providers</strong>
                    <p>In the left menu, scroll down and click "Resource providers"</p>
                </li>
                <li>
                    <strong>Find and Register Event Grid</strong>
                    <p>In the search box, type "Microsoft.EventGrid"</p>
                    <p>If the status shows "NotRegistered", click on it and then click "Register" at the top</p>
                    <p><strong>Wait 1-2 minutes</strong> until the status changes to "Registered"</p>
                </li>
            </ol>

            <div class="alert alert-success">
                <strong>‚úÖ Verification:</strong> The status should now show "Registered". You can proceed to the next step.
            </div>

            <h3>Step 2: Deploy FinOps Hub</h3>
            <ol class="steps">
                <li>
                    <strong>Click Deploy to Azure Button</strong>
                    <p>Click the button below to open the deployment form:</p>
                    <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FEuphoriaLux%2Ffinops-hub-deployment%2Fmain%2Ftemplate.json/createUIDefinitionUri/https%3A%2F%2Fraw.githubusercontent.com%2FEuphoriaLux%2Ffinops-hub-deployment%2Fmain%2FcreateUiDefinition.json%3Ft%3D1762981499" target="_blank" rel="noopener noreferrer">
                        <img src="https://aka.ms/deploytoazurebutton" alt="Deploy to Azure" style="max-width: 200px; margin: 1rem 0;">
                    </a>
                </li>
                <li>
                    <strong>Fill in Basic Information</strong>
                    <ul>
                        <li><strong>Subscription:</strong> Select your Azure subscription</li>
                        <li><strong>Resource Group:</strong> Create a new one (e.g., "rg-finops-hub") or select existing</li>
                        <li><strong>Region:</strong> Choose a location close to you (e.g., "West Europe")</li>
                    </ul>
                </li>
                <li>
                    <strong>Configure Hub Settings</strong>
                    <ul>
                        <li><strong>Hub Name:</strong> Enter a unique name (3-24 characters, lowercase letters and numbers only)</li>
                        <li>Example: "contoso-finops" or "mycompany-hub"</li>
                        <li><strong>Storage SKU:</strong> Keep default "Premium_LRS" (recommended for most users)</li>
                    </ul>
                </li>
                <li>
                    <strong>Review Advanced Settings</strong>
                    <p>You can leave these at their default values:</p>
                    <ul>
                        <li>Export Retention: 0 days (deletes raw files after processing to save costs)</li>
                        <li>Ingestion Retention: 13 months (keeps processed data for year-over-year comparison)</li>
                    </ul>
                </li>
                <li>
                    <strong>Start Deployment</strong>
                    <p>Click "Review + create" at the bottom</p>
                    <p>Review the summary and click "Create"</p>
                </li>
            </ol>

            <div class="alert alert-info">
                <strong>‚è±Ô∏è Deployment Time:</strong> The deployment will take 10-15 minutes. You can close the browser and come back later - it will continue in the background.
            </div>

            <h3>Step 3: Create Cost Management Exports</h3>
            <div class="alert alert-warning">
                <strong>Manual Setup Required:</strong> After deployment completes, you need to configure cost exports for each subscription you want to monitor.
            </div>

            <ol class="steps">
                <li>
                    <strong>Navigate to Cost Management</strong>
                    <p>In Azure Portal, go to <a href="https://portal.azure.com/#view/Microsoft_Azure_CostManagement/Menu/~/exports" target="_blank" rel="noopener noreferrer">Cost Management ‚Üí Exports</a></p>
                </li>
                <li>
                    <strong>Select Your Subscription</strong>
                    <p>At the top, use the "Scope" selector to choose the subscription you want to export costs from</p>
                </li>
                <li>
                    <strong>Create New Export</strong>
                    <p>Click "+ Create" button at the top</p>
                </li>
                <li>
                    <strong>Configure Export Basics</strong>
                    <ul>
                        <li><strong>Export name:</strong> <code>ftk-[your-hub-name]-focus</code></li>
                        <li><strong>Metric:</strong> Select "Cost and usage details (FOCUS)"</li>
                        <li><strong>Dataset version:</strong> Select "1.0"</li>
                        <li><strong>Export type:</strong> Select "Daily export of month-to-date costs"</li>
                    </ul>
                </li>
                <li>
                    <strong>Configure Storage Destination</strong>
                    <ul>
                        <li><strong>Storage account:</strong> Select your FinOps Hub storage account (starts with "finopshub")</li>
                        <li><strong>Container:</strong> Type "msexports" (or select if visible)</li>
                        <li><strong>Directory:</strong> Type "subscriptions/" followed by your subscription ID</li>
                    </ul>
                    <p><em>Tip: You can find your subscription ID in the Azure Portal under "Subscriptions"</em></p>
                </li>
                <li>
                    <strong>Configure File Format</strong>
                    <ul>
                        <li><strong>File format:</strong> Select "Parquet"</li>
                        <li><strong>Compression type:</strong> Select "Snappy"</li>
                        <li><strong>File partitioning:</strong> Check the box to enable it</li>
                    </ul>
                </li>
                <li>
                    <strong>Review and Create</strong>
                    <p>Click "Create" at the bottom</p>
                </li>
                <li>
                    <strong>Repeat for Additional Subscriptions</strong>
                    <p>If you want to monitor multiple subscriptions, repeat steps 2-7 for each one</p>
                </li>
            </ol>

            <div class="alert alert-success">
                <strong>‚úÖ First Export Timeline:</strong> Your first cost export will run within 4-8 hours. After that, it runs daily automatically.
            </div>

            <h3>Step 4: Verify Deployment</h3>
            <ol class="steps">
                <li>
                    <strong>Check Resource Group</strong>
                    <p>In Azure Portal, navigate to your resource group</p>
                    <p>You should see these resources:</p>
                    <ul>
                        <li>Storage Account (starts with "finopshub")</li>
                        <li>Data Factory (contains "engine")</li>
                        <li>Event Grid System Topic (ends with "-events")</li>
                        <li>Key Vault</li>
                        <li>Managed Identities</li>
                    </ul>
                </li>
                <li>
                    <strong>Follow Post-Deployment Checklist</strong>
                    <p>Review the <a href="../POST-DEPLOYMENT-CHECKLIST.md" target="_blank">Post-Deployment Checklist</a> to ensure everything is configured correctly</p>
                </li>
            </ol>

            <h3>üéâ Next Steps</h3>
            <div class="alert alert-success">
                <strong>Congratulations!</strong> Your FinOps Hub is now deployed and configured.
                <ul>
                    <li>Wait 4-8 hours for your first cost export to complete</li>
                    <li>Data will be automatically processed by Data Factory</li>
                    <li>Connect Power BI to visualize your cost data</li>
                </ul>
            </div>

            <p><a href="#troubleshooting" class="btn btn-primary">Troubleshooting Guide ‚Üí</a></p>
        </section>

        <!-- Developer Deployment Section -->
        <section id="deployment-developer" class="card user-path-content developer-content" style="display: none;">
            <div style="text-align: right; margin-bottom: 1rem;">
                <button type="button" onclick="showUserPath('selection')" class="btn btn-primary" style="font-size: 0.9rem;">‚Üê Change Deployment Path</button>
            </div>

            <h2>üíª Developer Deployment Guide</h2>
            <p class="alert alert-info">This guide provides PowerShell and Azure CLI scripts for automated deployment and configuration.</p>

            <h3>Prerequisites</h3>
            <ul>
                <li>Azure PowerShell (Az module) or Azure CLI installed</li>
                <li>Contributor role on target subscription</li>
                <li>PowerShell 7+ or Bash shell</li>
            </ul>

            <h3>Step 1: Register Resource Providers</h3>
            <p>Register the required Azure resource providers:</p>

            <pre><code class="language-powershell"># PowerShell
Register-AzResourceProvider -ProviderNamespace Microsoft.EventGrid  # ‚ö†Ô∏è CRITICAL - Must be registered BEFORE deployment
Register-AzResourceProvider -ProviderNamespace Microsoft.Storage
Register-AzResourceProvider -ProviderNamespace Microsoft.DataFactory

# Verify Event Grid is registered (wait for "Registered" status)
Get-AzResourceProvider -ProviderNamespace Microsoft.EventGrid | Select-Object ProviderNamespace, RegistrationState

# Azure CLI
az provider register --namespace Microsoft.EventGrid  # ‚ö†Ô∏è CRITICAL - Must be registered BEFORE deployment
az provider register --namespace Microsoft.Storage
az provider register --namespace Microsoft.DataFactory
# NOTE: Microsoft.CostManagementExports is NOT required (template uses enableManagedExports: false)

# Verify Event Grid is registered (wait for "Registered" status)
az provider show --namespace Microsoft.EventGrid --query "registrationState" --output tsv</code></pre>

            <div class="alert alert-danger">
                <strong>‚ö†Ô∏è CRITICAL:</strong> Wait until <code>Microsoft.EventGrid</code> shows status "Registered" before proceeding to deployment. If you deploy before Event Grid is registered, the Event Grid System Topic won't be created and automatic processing will NOT work.
            </div>

            <h3>Step 2: Deploy via Script</h3>

            <h4>Option A: PowerShell</h4>
            <pre><code class="language-powershell"># Set deployment parameters
$resourceGroupName = "rg-finops-hub"
$location = "westeurope"
$hubName = "mycompany-finops"  # 3-24 characters, lowercase letters and numbers only

# Create resource group
New-AzResourceGroup -Name $resourceGroupName -Location $location

# Deploy template
New-AzResourceGroupDeployment `
    -Name "finops-hub-deployment" `
    -ResourceGroupName $resourceGroupName `
    -TemplateUri "https://raw.githubusercontent.com/EuphoriaLux/finops-hub-deployment/main/template.json" `
    -hubName $hubName `
    -Verbose

# Monitor deployment progress
Get-AzResourceGroupDeployment -ResourceGroupName $resourceGroupName -Name "finops-hub-deployment"</code></pre>

            <h4>Option B: Azure CLI</h4>
            <pre><code class="language-bash"># Set deployment parameters
RESOURCE_GROUP="rg-finops-hub"
LOCATION="westeurope"
HUB_NAME="mycompany-finops"  # 3-24 characters, lowercase letters and numbers only

# Create resource group
az group create --name $RESOURCE_GROUP --location $LOCATION

# Deploy template
az deployment group create \
  --name finops-hub-deployment \
  --resource-group $RESOURCE_GROUP \
  --template-uri "https://raw.githubusercontent.com/EuphoriaLux/finops-hub-deployment/main/template.json" \
  --parameters hubName=$HUB_NAME \
  --verbose

# Monitor deployment
az deployment group show \
  --name finops-hub-deployment \
  --resource-group $RESOURCE_GROUP \
  --query "properties.provisioningState"</code></pre>

            <h4>Option C: Portal (Deploy to Azure Button)</h4>
            <p>Prefer visual deployment? Use the button below:</p>
            <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2FEuphoriaLux%2Ffinops-hub-deployment%2Fmain%2Ftemplate.json/createUIDefinitionUri/https%3A%2F%2Fraw.githubusercontent.com%2FEuphoriaLux%2Ffinops-hub-deployment%2Fmain%2FcreateUiDefinition.json%3Ft%3D1762981499" target="_blank" rel="noopener noreferrer">
                <img src="https://aka.ms/deploytoazurebutton" alt="Deploy to Azure">
            </a>

            <div class="alert alert-info">
                <strong>‚è±Ô∏è Deployment Time:</strong> 10-15 minutes. You can monitor progress using the commands above or in the Azure Portal.
            </div>

            <h3>Step 3: Automated Export Configuration (Non-CSP Only)</h3>
            <div class="alert alert-warning">
                <strong>Note:</strong> This automated approach works for EA, MCA, and Pay-as-you-go subscriptions. For CSP subscriptions, you must use the Export Wizard below for portal-based setup.
            </div>

            <p>Use the Export Wizard to generate a PowerShell script for your subscriptions:</p>
            <p><a href="#export-wizard" class="btn btn-primary">Go to Export Wizard ‚Üí</a></p>

            <h3>Step 4: Verify Deployment</h3>
            <pre><code class="language-powershell"># PowerShell - Check deployed resources
Get-AzResource -ResourceGroupName $resourceGroupName | Select-Object Name, ResourceType

# Verify Event Grid System Topic exists
Get-AzEventGridSystemTopic -ResourceGroupName $resourceGroupName

# Check Data Factory trigger status
$dataFactoryName = (Get-AzDataFactoryV2 -ResourceGroupName $resourceGroupName).DataFactoryName
Get-AzDataFactoryV2Trigger -ResourceGroupName $resourceGroupName -DataFactoryName $dataFactoryName</code></pre>

            <pre><code class="language-bash"># Azure CLI - Check deployed resources
az resource list --resource-group $RESOURCE_GROUP --output table

# Verify Event Grid System Topic exists
az eventgrid system-topic list --resource-group $RESOURCE_GROUP --output table

# Check Data Factory trigger status
DATA_FACTORY=$(az datafactory list --resource-group $RESOURCE_GROUP --query "[0].name" -o tsv)
az datafactory trigger list --resource-group $RESOURCE_GROUP --factory-name $DATA_FACTORY --output table</code></pre>

            <div class="alert alert-success">
                <strong>‚úÖ Success Indicators:</strong>
                <ul>
                    <li>Event Grid System Topic exists (name ends with "-events")</li>
                    <li>Data Factory has active triggers</li>
                    <li>Storage account has "msexports" and "ingestion" containers</li>
                </ul>
                See the <a href="../POST-DEPLOYMENT-CHECKLIST.md" target="_blank">Post-Deployment Checklist</a> for detailed verification.
            </div>

            <h3>üéâ Next Steps</h3>
            <ul>
                <li>Configure Cost Management exports (use Export Wizard below)</li>
                <li>Wait 4-8 hours for first export to complete</li>
                <li>Connect Power BI for visualization</li>
                <li>Set up alerts and monitoring</li>
            </ul>
        </section>

        <!-- Original Deployment Section (hidden, kept for reference) -->
        <section id="deployment" class="card" style="display: none;">
            <h2>Deployment Steps</h2>
            <p class="alert alert-info">Please select your deployment path above (Business User or Developer) for tailored instructions.</p>
        </section>

        <!-- Export Setup Section -->
        <section id="exports" class="card">
            <h2>Setting Up Cost Exports</h2>

            <div class="alert alert-warning">
                <strong>Manual Configuration Required:</strong> For CSP subscriptions, cost exports must be created manually through the Azure Portal due to API restrictions.
            </div>

            <h3>Export Configuration</h3>
            <p>Each subscription requires a FOCUS 1.0 export with the following configuration:</p>

            <table>
                <thead>
                    <tr>
                        <th>Setting</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Export Name</td>
                        <td><code>ftk-{hubName}-focus</code></td>
                    </tr>
                    <tr>
                        <td>Export Type</td>
                        <td>Cost and usage details (FOCUS)</td>
                    </tr>
                    <tr>
                        <td>Dataset Version</td>
                        <td>1.0</td>
                    </tr>
                    <tr>
                        <td>Format</td>
                        <td>Parquet</td>
                    </tr>
                    <tr>
                        <td>Compression</td>
                        <td>Snappy</td>
                    </tr>
                    <tr>
                        <td>Frequency</td>
                        <td>Daily (Month-to-Date)</td>
                    </tr>
                    <tr>
                        <td>File Partitioning</td>
                        <td>On</td>
                    </tr>
                    <tr>
                        <td>Container</td>
                        <td>msexports</td>
                    </tr>
                    <tr>
                        <td>Directory</td>
                        <td>subscriptions/{subscription-id}</td>
                    </tr>
                </tbody>
            </table>

            <h3>Manual Export Creation (Recommended for CSP)</h3>
            <ol class="steps">
                <li>
                    <strong>Navigate to Cost Management</strong>
                    <p>Go to <a href="https://portal.azure.com/#view/Microsoft_Azure_CostManagement/Menu/~/exports" target="_blank">Azure Portal ‚Üí Cost Management ‚Üí Exports</a></p>
                </li>
                <li>
                    <strong>Select Subscription</strong>
                    <p>Use the scope selector to choose the target subscription</p>
                </li>
                <li>
                    <strong>Create Export</strong>
                    <p>Click "+ Create" and fill in the configuration values from the table above</p>
                </li>
                <li>
                    <strong>Configure Storage Destination</strong>
                    <ul>
                        <li>Select your FinOps Hub storage account</li>
                        <li>Container: <code>msexports</code></li>
                        <li>Directory: <code>subscriptions/{subscription-id}</code> (use the actual subscription GUID)</li>
                    </ul>
                </li>
                <li>
                    <strong>Review and Create</strong>
                    <p>Verify all settings and click "Create"</p>
                </li>
            </ol>

            <div class="alert alert-info">
                <strong>First Export Timeline:</strong> After creation, the first export typically completes within 4-8 hours. Data will then be automatically processed by Data Factory.
            </div>
        </section>

        <!-- Export Wizard Section -->
        <section id="export-wizard" class="card interactive-section">
            <h2>üßô Export Configuration Wizard</h2>
            <p>Use this wizard to generate PowerShell scripts or detailed portal instructions for configuring your Cost Management exports.</p>

            <div class="wizard-form">
                <div class="form-group">
                    <label for="wizardHubName">Hub Name *</label>
                    <input type="text" id="wizardHubName" placeholder="e.g., contoso-finops" maxlength="24">
                    <span class="help-text">The same hub name you used during deployment</span>
                </div>

                <div class="form-group">
                    <label for="wizardSubscriptionIds">Subscription IDs *</label>
                    <textarea id="wizardSubscriptionIds" rows="5" placeholder="Enter subscription IDs (one per line or comma-separated)&#10;e.g.,&#10;12345678-1234-1234-1234-123456789012&#10;87654321-4321-4321-4321-210987654321"></textarea>
                    <span class="help-text">Enter one or more Azure subscription IDs</span>
                </div>

                <div class="form-group">
                    <label>Output Format</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="outputPortal" name="outputType" value="portal" checked>
                            <label for="outputPortal" class="radio-option-label">
                                <strong>Portal Instructions</strong> - Step-by-step manual setup (Recommended for CSP)
                            </label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="outputPowerShell" name="outputType" value="powershell">
                            <label for="outputPowerShell" class="radio-option-label">
                                <strong>PowerShell Script</strong> - Automated (for non-CSP subscriptions only)
                            </label>
                        </div>
                    </div>
                </div>

                <button type="button" id="generateExportBtn" class="btn btn-primary">Generate Configuration</button>
            </div>

            <!-- Output Area (hidden until generated) -->
            <div id="wizardOutput" class="output-area" style="display: none;">
                <pre><code id="wizardGeneratedCode" class="language-powershell"></code></pre>
                <button type="button" id="copyExportBtn" class="btn btn-success">Copy to Clipboard</button>
            </div>

            <div class="alert alert-info" style="margin-top: 1.5rem;">
                <strong>üí° Tips:</strong>
                <ul>
                    <li>Use PowerShell script for <strong>non-CSP subscriptions</strong> (EA, MCA, Pay-as-you-go)</li>
                    <li>Use Portal instructions for <strong>CSP subscriptions</strong> (API restrictions apply)</li>
                    <li>Your configuration is saved locally for convenience</li>
                </ul>
            </div>
        </section>

        <!-- CSP Section -->
        <section id="csp" class="card">
            <h2>CSP Subscription Considerations</h2>

            <div class="alert alert-danger">
                <strong>CSP API Restriction:</strong> Cloud Solution Provider (CSP) subscriptions have restrictions on programmatic Cost Management API access. Automated export creation via PowerShell/REST API is blocked.
            </div>

            <h3>Why Automation Doesn't Work for CSP</h3>
            <p>CSP subscriptions have a unique architecture where:</p>
            <ul>
                <li>The <strong>Partner tenant</strong> owns the subscriptions</li>
                <li>Customer tenant users have delegated access</li>
                <li>Cost Management APIs require Partner tenant authentication</li>
                <li>Customer tenant API calls return <code>401 Unauthorized</code></li>
            </ul>

            <div class="grid">
                <div>
                    <h4>Portal Access (‚úÖ Works)</h4>
                    <p>User-interactive authentication allows Portal access with your customer credentials</p>
                </div>
                <div>
                    <h4>API Access (‚ùå Blocked)</h4>
                    <p>Programmatic authentication requires Partner tenant credentials</p>
                </div>
            </div>

            <h3>Solution Options</h3>

            <h4>Option 1: Manual Portal Setup (Recommended)</h4>
            <p><strong>Time Required:</strong> 5-10 minutes per subscription</p>
            <p>Follow the manual export creation steps in the <a href="#exports">Export Setup</a> section above.</p>

            <h4>Option 2: Partner-Side Automation</h4>
            <p>Contact your CSP Partner and request they:</p>
            <ul>
                <li>Run export creation scripts from their Partner tenant</li>
                <li>Set up Azure Lighthouse delegation</li>
                <li>Configure exports through Partner Center</li>
            </ul>

            <h4>Option 3: Azure Lighthouse</h4>
            <p>Set up Azure Lighthouse delegation to give Partner explicit programmatic access:</p>
            <ul>
                <li>Partner creates Lighthouse offer with Cost Management permissions</li>
                <li>Customer accepts delegation</li>
                <li>Partner can manage exports programmatically</li>
            </ul>

            <div class="alert alert-info">
                <strong>Recommendation:</strong> Use manual Portal setup for immediate needs (40 minutes for 4 subscriptions). Work with your CSP Partner for long-term automation.
            </div>
        </section>

        <!-- Troubleshooting Section -->
        <section id="troubleshooting" class="card">
            <h2>Troubleshooting</h2>

            <h3>Common Issues and Solutions</h3>

            <div class="alert alert-info">
                <strong>üìã First Time Setup:</strong> If this is your first deployment, follow the <a href="../POST-DEPLOYMENT-CHECKLIST.md" target="_blank">Post-Deployment Checklist</a> to verify all components are configured correctly.
            </div>

            <h4>Deployment Failures</h4>
            <div class="alert alert-warning">
                <strong>Error:</strong> "The subscription is not registered to use namespace 'Microsoft.Storage'"
                <br><strong>Solution:</strong> Register the required resource providers (see <a href="#deployment">Deployment Steps</a>)
            </div>

            <h4>Event Grid System Topic is Missing</h4>
            <div class="alert alert-danger">
                <strong>Symptoms:</strong>
                <ul>
                    <li>No automatic pipeline runs triggered when exports complete</li>
                    <li>Event Grid System Topic not visible in resource group</li>
                </ul>
                <strong>Cause:</strong> Microsoft.EventGrid provider was not registered before deployment
                <br><br>
                <strong>Solution:</strong>
                <ol>
                    <li>Register the Event Grid provider:</li>
                </ol>
                <pre><code class="language-powershell">az provider register --namespace Microsoft.EventGrid</code></pre>
                <ol start="2">
                    <li>Create the Event Grid System Topic manually:</li>
                </ol>
                <pre><code class="language-powershell"># Get your storage account resource ID
$STORAGE_ID = az storage account show `
  --name &lt;your-storage-account-name&gt; `
  --resource-group &lt;your-resource-group&gt; `
  --query id --output tsv

# Create Event Grid System Topic
az eventgrid system-topic create `
  --name &lt;storage-account-name&gt;-events `
  --resource-group &lt;your-resource-group&gt; `
  --source $STORAGE_ID `
  --topic-type Microsoft.Storage.StorageAccounts `
  --location &lt;your-region&gt;</code></pre>
                <ol start="3">
                    <li>Verify trigger starts successfully:</li>
                </ol>
                <pre><code class="language-powershell">az datafactory trigger start `
  --factory-name &lt;your-data-factory-name&gt; `
  --resource-group &lt;your-resource-group&gt; `
  --name msexports_ManifestAdded</code></pre>
                <p>See <a href="../POST-DEPLOYMENT-CHECKLIST.md" target="_blank">Post-Deployment Checklist</a> for detailed verification steps.</p>
            </div>

            <h4>Export Creation 401 Errors</h4>
            <div class="alert alert-warning">
                <strong>Error:</strong> 401 Unauthorized when creating exports via PowerShell
                <br><strong>Solution:</strong> Use manual Portal setup for CSP subscriptions (see <a href="#csp">CSP Considerations</a>)
            </div>

            <h4>Storage Account Not Found</h4>
            <div class="alert alert-warning">
                <strong>Error:</strong> Cannot find storage account in resource group
                <br><strong>Solution:</strong> Verify deployment completed successfully. Check that you're in the correct subscription and resource group.
            </div>

            <h4>Export Not Running</h4>
            <div class="alert alert-warning">
                <strong>Issue:</strong> Export created but no data appearing
                <br><strong>Solution:</strong>
                <ul>
                    <li>Wait 4-8 hours for first export to complete</li>
                    <li>Verify export is "Active" in the Portal</li>
                    <li>Check storage account permissions</li>
                    <li>Ensure msexports container exists</li>
                </ul>
            </div>

            <h3>Getting Help</h3>
            <p>If you encounter issues not covered here:</p>
            <ul>
                <li>Check the <a href="https://github.com/microsoft/finops-toolkit/issues" target="_blank">FinOps Toolkit GitHub Issues</a></li>
                <li>Review <a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/" target="_blank">Azure Cost Management documentation</a></li>
                <li>Contact your Azure support team</li>
            </ul>
        </section>

        <!-- Resources Section -->
        <section id="resources" class="card">
            <h2>Additional Resources</h2>

            <h3>Official Documentation</h3>
            <ul>
                <li><a href="https://learn.microsoft.com/en-us/cloud-computing/finops/toolkit/finops-toolkit-overview" target="_blank">FinOps Toolkit Overview</a></li>
                <li><a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/tutorial-export-acm-data" target="_blank">Azure Cost Management Exports</a></li>
                <li><a href="https://learn.microsoft.com/en-us/azure/cost-management-billing/dataset-schema/cost-usage-details-focus" target="_blank">FOCUS Dataset Documentation</a></li>
                <li><a href="https://focus.finops.org/" target="_blank">FinOps FOCUS Specification</a></li>
            </ul>

            <h3>GitHub Repository</h3>
            <ul>
                <li><a href="https://github.com/microsoft/finops-toolkit" target="_blank">FinOps Toolkit on GitHub</a></li>
                <li><a href="https://github.com/microsoft/finops-toolkit/tree/main/src/templates/finops-hub" target="_blank">FinOps Hub ARM Template</a></li>
            </ul>

            <h3>CSP-Specific Resources</h3>
            <ul>
                <li><a href="https://learn.microsoft.com/en-us/partner-center/csp-overview" target="_blank">CSP Program Overview</a></li>
                <li><a href="https://learn.microsoft.com/en-us/azure/lighthouse/overview" target="_blank">Azure Lighthouse Documentation</a></li>
                <li><a href="https://partner.microsoft.com/" target="_blank">Microsoft Partner Center</a></li>
            </ul>

            <h3>Power BI Reports</h3>
            <ul>
                <li><a href="https://learn.microsoft.com/en-us/cloud-computing/finops/toolkit/power-bi" target="_blank">FinOps Toolkit Power BI Reports</a></li>
                <li><a href="https://app.powerbi.com/" target="_blank">Power BI Service</a></li>
            </ul>
        </section>

        <!-- Quick Reference -->
        <section class="card">
            <h2>Quick Reference</h2>

            <h3>Key Configuration Values</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Export Name Format</td>
                        <td><code>ftk-{hubName}-focus</code></td>
                        <td>Naming convention for exports</td>
                    </tr>
                    <tr>
                        <td>Storage Container</td>
                        <td><code>msexports</code></td>
                        <td>Container for cost export data</td>
                    </tr>
                    <tr>
                        <td>Directory Pattern</td>
                        <td><code>subscriptions/{id}</code></td>
                        <td>Folder structure for exports</td>
                    </tr>
                    <tr>
                        <td>API Version (Portal)</td>
                        <td><code>2025-03-01</code></td>
                        <td>Latest API supporting FOCUS</td>
                    </tr>
                    <tr>
                        <td>Dataset Version</td>
                        <td><code>1.0</code></td>
                        <td>FOCUS specification version</td>
                    </tr>
                    <tr>
                        <td>Export Frequency</td>
                        <td>Daily (MonthToDate)</td>
                        <td>Recommended schedule</td>
                    </tr>
                </tbody>
            </table>

            <h3>Estimated Costs</h3>
            <div class="alert alert-info">
                <strong>Monthly Cost Estimate:</strong> -$20 USD (credits from export cost savings typically exceed infrastructure costs)
                <ul>
                    <li>Storage Account: ~$5-10/month</li>
                    <li>Data Factory: ~$5-10/month</li>
                    <li>Cost Optimization Savings: Typically $50-500+/month</li>
                </ul>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 FinOps Hub Deployment Guide</p>
            <p>
                <a href="https://github.com/microsoft/finops-toolkit" target="_blank" rel="noopener">GitHub Repository</a> |
                <a href="https://learn.microsoft.com/en-us/cloud-computing/finops/toolkit/finops-toolkit-overview" target="_blank" rel="noopener">Official Documentation</a> |
                <a href="https://focus.finops.org/" target="_blank" rel="noopener">FOCUS Specification</a>
            </p>
        </div>
    </footer>

    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"></script>

    <!-- Interactive Feature Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/architecture-diagram.js"></script>
    <script src="js/config-builder.js"></script>
    <script src="js/export-wizard.js"></script>

    <!-- User Path Selection Script -->
    <script>
        // User path selection functionality
        function showUserPath(path) {
            // Get all sections
            const selectionSection = document.getElementById('user-path-selection');
            const overviewSection = document.getElementById('overview');
            const lambdaDeploySection = document.getElementById('deployment-lambda');
            const devDeploySection = document.getElementById('deployment-developer');
            const originalDeploySection = document.getElementById('deployment');

            // Hide all sections first
            if (selectionSection) selectionSection.style.display = 'none';
            if (overviewSection) overviewSection.style.display = 'none';
            if (lambdaDeploySection) lambdaDeploySection.style.display = 'none';
            if (devDeploySection) devDeploySection.style.display = 'none';

            // Show relevant sections based on path
            if (path === 'selection') {
                if (selectionSection) selectionSection.style.display = 'block';
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (path === 'lambda') {
                if (overviewSection) overviewSection.style.display = 'block';
                if (lambdaDeploySection) lambdaDeploySection.style.display = 'block';
                // Scroll to deployment section
                setTimeout(() => {
                    lambdaDeploySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
                // Store preference
                localStorage.setItem('finops-user-path', 'lambda');
            } else if (path === 'developer') {
                if (overviewSection) overviewSection.style.display = 'block';
                if (devDeploySection) devDeploySection.style.display = 'block';
                // Scroll to deployment section
                setTimeout(() => {
                    devDeploySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
                // Store preference
                localStorage.setItem('finops-user-path', 'developer');
            }
        }

        // Check if user has a saved preference on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedPath = localStorage.getItem('finops-user-path');

            // Check if URL has a hash that might indicate section navigation
            const hash = window.location.hash;

            if (hash && hash !== '#overview' && hash !== '#user-path-selection') {
                // User is navigating to a specific section, show both paths
                const overviewSection = document.getElementById('overview');
                const lambdaDeploySection = document.getElementById('deployment-lambda');
                const devDeploySection = document.getElementById('deployment-developer');
                const selectionSection = document.getElementById('user-path-selection');

                if (selectionSection) selectionSection.style.display = 'none';
                if (overviewSection) overviewSection.style.display = 'block';
                if (lambdaDeploySection) lambdaDeploySection.style.display = 'block';
                if (devDeploySection) devDeploySection.style.display = 'block';
            } else if (savedPath) {
                // User has a saved preference
                showUserPath(savedPath);
            } else {
                // New user, show selection
                showUserPath('selection');
            }
        });
    </script>
</body>
</html>
